Rewrite of original mpapi in C#